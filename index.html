
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Sistema P칩s-Obra Avan칞ado</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-800">

<div class="max-w-4xl mx-auto p-6">

  <div id="loginScreen" class="bg-white shadow-md rounded-lg p-6">
    <h2 class="text-2xl font-bold mb-4">Login</h2>
    <input type="email" id="email" placeholder="Email" class="w-full mb-2 p-2 border rounded" />
    <input type="password" id="password" placeholder="Senha" class="w-full mb-4 p-2 border rounded" />
    <button onclick="login()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Entrar</button>
    <p id="loginMessage" class="text-red-500 mt-2"></p>
  </div>

  <div id="mainApp" class="hidden bg-white shadow-md rounded-lg p-6 mt-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-bold">Bem-vindo <span id="userName"></span></h2>
      <button onclick="logout()" class="text-red-500 hover:underline">Sair</button>
    </div>

    <div class="mb-6">
      <h3 class="text-lg font-semibold mb-2">Obras</h3>
      <div id="obrasList" class="space-y-2"></div>
      <button onclick="toggleForm('obraForm')" class="mt-2 text-sm text-blue-600 hover:underline">Nova Obra</button>
      <div id="obraForm" class="hidden mt-4 space-y-2">
        <input id="obraNome" placeholder="Nome da obra" class="w-full p-2 border rounded" />
        <input id="obraEndereco" placeholder="Endere칞o" class="w-full p-2 border rounded" />
        <input id="obraResponsavel" placeholder="Respons치vel pela obra" class="w-full p-2 border rounded" />
        <button onclick="adicionarObra()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Salvar Obra</button>
      </div>
    </div>

    <div class="mb-6">
      <h3 class="text-lg font-semibold mb-2">Documentos</h3>
      <div id="documentosList" class="space-y-2"></div>
      <div class="mt-4 space-y-2">
        <input id="docNome" placeholder="Nome do documento" class="w-full p-2 border rounded" />
        <select id="docCategoria" class="w-full p-2 border rounded">
          <option value="projeto">Projeto</option>
          <option value="manual">Manual</option>
          <option value="garantia">Garantia</option>
        </select>
        <input type="file" id="docArquivo" class="w-full p-2 border rounded" />
        <textarea id="docDescricao" placeholder="Descri칞칚o" class="w-full p-2 border rounded"></textarea>
        <button onclick="adicionarDocumento()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Salvar Documento</button>
      </div>
    </div>
  </div>

</div>

<script>
function toggleForm(id) {
  document.getElementById(id).classList.toggle('hidden');
}

function initUser() {
  let users = JSON.parse(localStorage.getItem('usuarios') || '[]');
  if (!users.find(u => u.email === 'admin@admin.com')) {
    users.push({ nome: 'Admin', email: 'admin@admin.com', senha: 'admin123', ativo: true });
    localStorage.setItem('usuarios', JSON.stringify(users));
  }
}

function login() {
  const email = document.getElementById('email').value.trim();
  const senha = document.getElementById('password').value.trim();
  const users = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const user = users.find(u => u.email === email && u.senha === senha && u.ativo);
  if (user) {
    localStorage.setItem('currentUser', JSON.stringify(user));
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('mainApp').classList.remove('hidden');
    document.getElementById('userName').textContent = user.nome;
    carregarObras();
    carregarDocumentos();
  } else {
    document.getElementById('loginMessage').textContent = "Credenciais inv치lidas.";
  }
}

function logout() {
  localStorage.removeItem('currentUser');
  document.getElementById('mainApp').classList.add('hidden');
  document.getElementById('loginScreen').classList.remove('hidden');
}

function adicionarObra() {
  const nome = document.getElementById('obraNome').value;
  const endereco = document.getElementById('obraEndereco').value;
  const responsavel = document.getElementById('obraResponsavel').value;
  const user = JSON.parse(localStorage.getItem('currentUser'));
  let obras = JSON.parse(localStorage.getItem('obras') || '[]');
  obras.push({ id: Date.now(), nome, endereco, responsavel, userEmail: user.email });
  localStorage.setItem('obras', JSON.stringify(obras));
  carregarObras();
}

function carregarObras() {
  const user = JSON.parse(localStorage.getItem('currentUser'));
  const obras = JSON.parse(localStorage.getItem('obras') || '[]').filter(o => o.userEmail === user.email);
  document.getElementById('obrasList').innerHTML = obras.map(o => `
    <div class="p-3 border border-gray-200 rounded bg-gray-50">
      <b>${o.nome}</b><br>${o.endereco}<br><small>Respons치vel: ${o.responsavel}</small>
    </div>`).join('');
}

function adicionarDocumento() {
  const nome = document.getElementById('docNome').value;
  const categoria = document.getElementById('docCategoria').value;
  const descricao = document.getElementById('docDescricao').value;
  const fileInput = document.getElementById('docArquivo');
  const user = JSON.parse(localStorage.getItem('currentUser'));
  const reader = new FileReader();
  reader.onload = function (e) {
    let documentos = JSON.parse(localStorage.getItem('documentos') || '[]');
    documentos.push({
      id: Date.now(),
      nome,
      categoria,
      descricao,
      arquivoNome: fileInput.files[0].name,
      arquivoBase64: e.target.result,
      usuario: user.email
    });
    localStorage.setItem('documentos', JSON.stringify(documentos));
    carregarDocumentos();
  };
  reader.readAsDataURL(fileInput.files[0]);
}

function carregarDocumentos() {
  const user = JSON.parse(localStorage.getItem('currentUser'));
  const documentos = JSON.parse(localStorage.getItem('documentos') || '[]').filter(d => d.usuario === user.email);
  document.getElementById('documentosList').innerHTML = documentos.map(d => `
    <div class="p-3 border border-gray-200 rounded bg-gray-50">
      <b>${d.nome}</b> (${d.categoria})<br>
      <a href="${d.arquivoBase64}" download="${d.arquivoNome}" class="text-blue-600 underline">游닌 Baixar</a>
    </div>`).join('');
}

initUser();
</script>

</body>
</html>
