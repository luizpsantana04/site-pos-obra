
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Sistema PÃ³s-Obra Completo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial; background: #f3f4f6; padding: 0; margin: 0; }
    .container { max-width: 800px; margin: 40px auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h2, h3 { color: #111827; }
    input, select, textarea { width: 100%; padding: 10px; margin: 5px 0 15px; border: 1px solid #ccc; border-radius: 5px; }
    button { background: #2563eb; color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #1d4ed8; }
    .hidden { display: none; }
    .card { border: 1px solid #ddd; border-radius: 5px; padding: 10px; margin-bottom: 10px; }
  </style>
</head>
<body>

<div class="container" id="loginScreen">
  <h2>Login</h2>
  <input type="email" id="email" placeholder="Email" />
  <input type="password" id="password" placeholder="Senha" />
  <button onclick="login()">Entrar</button>
  <p id="loginMessage" style="color:red;"></p>
</div>

<div class="container hidden" id="mainApp">
  <h2>Bem-vindo <span id="userName"></span></h2>
  <button onclick="logout()">Sair</button>

  <h3>Obras</h3>
  <div id="obrasList"></div>
  <button onclick="toggleForm('obraForm')">Nova Obra</button>
  <div id="obraForm" class="hidden">
    <input id="obraNome" placeholder="Nome da obra" />
    <input id="obraEndereco" placeholder="EndereÃ§o" />
    <button onclick="adicionarObra()">Salvar Obra</button>
  </div>

  <h3>ManutenÃ§Ãµes</h3>
  <div id="manutencoesList"></div>
  <div id="manutencaoForm">
    <input id="manutencaoTitulo" placeholder="TÃ­tulo" />
    <input id="manutencaoData" type="date" />
    <select id="manutencaoPrioridade">
      <option value="baixa">Baixa</option>
      <option value="media">MÃ©dia</option>
      <option value="alta">Alta</option>
    </select>
    <textarea id="manutencaoDescricao" placeholder="DescriÃ§Ã£o"></textarea>
    <button onclick="adicionarManutencao()">Salvar ManutenÃ§Ã£o</button>
  </div>

  <h3>Documentos</h3>
  <div id="documentosList"></div>
  <div id="documentoForm">
    <input id="docNome" placeholder="Nome do documento" />
    <select id="docCategoria">
      <option value="projeto">Projeto</option>
      <option value="planta">Planta</option>
      <option value="manual">Manual</option>
      <option value="garantia">Garantia</option>
    </select>
    <input type="file" id="docArquivo" />
    <textarea id="docDescricao" placeholder="DescriÃ§Ã£o"></textarea>
    <button onclick="adicionarDocumento()">Salvar Documento</button>
  </div>

  <h3>Linha do Tempo (Eventos)</h3>
  <div id="eventosList"></div>
  <div id="eventoForm">
    <input id="eventoTitulo" placeholder="TÃ­tulo do evento" />
    <input id="eventoData" type="date" />
    <textarea id="eventoDescricao" placeholder="DescriÃ§Ã£o"></textarea>
    <button onclick="adicionarEvento()">Salvar Evento</button>
  </div>
</div>

<script>
function toggleForm(id) {
  document.getElementById(id).classList.toggle('hidden');
}

function initUser() {
  let users = JSON.parse(localStorage.getItem('usuarios') || '[]');
  if (!users.find(u => u.email === 'admin@admin.com')) {
    users.push({ nome: 'Admin', email: 'admin@admin.com', senha: 'admin123', ativo: true });
    localStorage.setItem('usuarios', JSON.stringify(users));
  }
}

function login() {
  const email = document.getElementById('email').value.trim();
  const senha = document.getElementById('password').value.trim();
  const users = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const user = users.find(u => u.email === email && u.senha === senha && u.ativo);
  if (user) {
    localStorage.setItem('currentUser', JSON.stringify(user));
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('mainApp').classList.remove('hidden');
    document.getElementById('userName').textContent = user.nome;
    carregarObras(); carregarManutencoes(); carregarDocumentos(); carregarEventos();
  } else {
    document.getElementById('loginMessage').textContent = "Credenciais invÃ¡lidas.";
  }
}

function logout() {
  localStorage.removeItem('currentUser');
  document.getElementById('mainApp').classList.add('hidden');
  document.getElementById('loginScreen').classList.remove('hidden');
}

function adicionarObra() {
  const nome = document.getElementById('obraNome').value;
  const endereco = document.getElementById('obraEndereco').value;
  const user = JSON.parse(localStorage.getItem('currentUser'));
  let obras = JSON.parse(localStorage.getItem('obras') || '[]');
  obras.push({ id: Date.now(), nome, endereco, userEmail: user.email });
  localStorage.setItem('obras', JSON.stringify(obras));
  carregarObras();
}

function carregarObras() {
  const user = JSON.parse(localStorage.getItem('currentUser'));
  const obras = JSON.parse(localStorage.getItem('obras') || '[]').filter(o => o.userEmail === user.email);
  document.getElementById('obrasList').innerHTML = obras.map(o => `<div class="card"><b>${o.nome}</b><br>${o.endereco}</div>`).join('');
}

function adicionarManutencao() {
  const titulo = document.getElementById('manutencaoTitulo').value;
  const data = document.getElementById('manutencaoData').value;
  const prioridade = document.getElementById('manutencaoPrioridade').value;
  const descricao = document.getElementById('manutencaoDescricao').value;
  const user = JSON.parse(localStorage.getItem('currentUser'));
  let m = JSON.parse(localStorage.getItem('manutencoes') || '[]');
  m.push({ id: Date.now(), titulo, data, prioridade, descricao, userEmail: user.email });
  localStorage.setItem('manutencoes', JSON.stringify(m));
  carregarManutencoes();
}

function carregarManutencoes() {
  const user = JSON.parse(localStorage.getItem('currentUser'));
  const m = JSON.parse(localStorage.getItem('manutencoes') || '[]').filter(m => m.userEmail === user.email);
  document.getElementById('manutencoesList').innerHTML = m.map(m => `<div class="card"><b>${m.titulo}</b> (${m.prioridade})<br>${m.descricao} - ${m.data}</div>`).join('');
}

function adicionarDocumento() {
  const nome = document.getElementById('docNome').value;
  const categoria = document.getElementById('docCategoria').value;
  const descricao = document.getElementById('docDescricao').value;
  const fileInput = document.getElementById('docArquivo');
  const user = JSON.parse(localStorage.getItem('currentUser'));
  const reader = new FileReader();
  reader.onload = function (e) {
    let documentos = JSON.parse(localStorage.getItem('documentos') || '[]');
    documentos.push({ id: Date.now(), nome, categoria, descricao, arquivoNome: fileInput.files[0].name, arquivoBase64: e.target.result, usuario: user.email });
    localStorage.setItem('documentos', JSON.stringify(documentos));
    carregarDocumentos();
  };
  reader.readAsDataURL(fileInput.files[0]);
}

function carregarDocumentos() {
  const user = JSON.parse(localStorage.getItem('currentUser'));
  const documentos = JSON.parse(localStorage.getItem('documentos') || '[]').filter(d => d.usuario === user.email);
  document.getElementById('documentosList').innerHTML = documentos.map(d => `<div class="card"><b>${d.nome}</b> (${d.categoria})<br><a href="${d.arquivoBase64}" download="${d.arquivoNome}">ðŸ“¥ Baixar</a></div>`).join('');
}

function adicionarEvento() {
  const titulo = document.getElementById('eventoTitulo').value;
  const data = document.getElementById('eventoData').value;
  const descricao = document.getElementById('eventoDescricao').value;
  const user = JSON.parse(localStorage.getItem('currentUser'));
  let eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  eventos.push({ id: Date.now(), titulo, data, descricao, userEmail: user.email });
  localStorage.setItem('eventos', JSON.stringify(eventos));
  carregarEventos();
}

function carregarEventos() {
  const user = JSON.parse(localStorage.getItem('currentUser'));
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]').filter(e => e.userEmail === user.email);
  document.getElementById('eventosList').innerHTML = eventos.map(e => `<div class="card"><b>${e.titulo}</b><br>${e.descricao}<br><small>${e.data}</small></div>`).join('');
}

initUser();
</script>
</body>
</html>
