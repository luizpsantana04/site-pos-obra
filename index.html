<!-- Página de Obras separada -->
<div id="obrasView" class="container my-4 hidden">
  <h2>Obras</h2>
  <div class="mb-3">
    <input id="filtroObra" class="form-control" placeholder="Filtrar por nome ou responsável" oninput="filtrarObras()">
  </div>
  <ul class="list-group" id="listaCompletaObras"></ul>
</div>

<script>
  function mostrarObrasView() {
    document.getElementById("appView").classList.add("hidden");
    document.getElementById("obrasView").classList.remove("hidden");
    carregarObrasCompleta();
  }

  function carregarObrasCompleta() {
    const lista = document.getElementById("listaCompletaObras");
    lista.innerHTML = "Carregando...";
    db.ref("obras").once("value", snapshot => {
      const obras = snapshot.val() || {};
      lista.innerHTML = "";
      Object.entries(obras).forEach(([key, o]) => {
        const li = document.createElement("li");
        li.className = "list-group-item";
        li.innerHTML = `
          <strong>${o.nome}</strong><br>
          Responsável: ${o.responsavel}<br>
          Endereço: ${o.endereco}<br>
          <input type='file' onchange='uploadDocumento(this, "${key}")'>
          <small class='text-muted'>Enviar documento</small>
        `;
        lista.appendChild(li);
      });
    });
  }

  function filtrarObras() {
    const filtro = document.getElementById("filtroObra").value.toLowerCase();
    const items = document.querySelectorAll("#listaCompletaObras li");
    items.forEach(item => {
      item.style.display = item.textContent.toLowerCase().includes(filtro) ? "block" : "none";
    });
  }

  function uploadDocumento(input, obraId) {
    const file = input.files[0];
    if (!file) return;
    const storageRef = firebase.storage().ref(`documentos/${obraId}/${file.name}`);
    storageRef.put(file).then(snapshot => {
      alert("Documento enviado com sucesso para " + obraId);
    }).catch(err => alert("Erro ao enviar documento: " + err));
  }
</script>
